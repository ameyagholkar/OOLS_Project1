<% if !session[:id] %>
    <p><%= link_to "Login to Post", login_path %></p>
<% end %>
<h1><%= session[:username] %> is allowed to Add Posts ID: <%= session[:id] %></h1>

<!-- This if-else block prevents adding of posts if not signed in -->
<% if session[:id] %>
<%= "Add Post:" %>
  <%= form_tag(:action => :add_post, :user_id => session[:id]) do %>
    <%= text_area_tag(:text) %>
    <%= submit_tag("Post") %>
    <% end %>
<% end %>
<h1>Listing posts</h1>

<table>
  <tr>
  </tr>

<% @posts.each do |post| %>
  <tr>
    <div class="post">
    <b><%= h(get_username(post.users_id)) %>: </b> <%= h(post.description) %>

      <% Post.all(:conditions => {:parent => post}, :order => "num_of_votes DESC" ).each do |reply| %>
          <br>
          <div class = "reply">
             <b><%= h(get_username(reply.users_id)) %>: </b> <%= h(reply.description) %>
             <% if session[:id] %>
             <%= button_to "Vote reply" , :action => :add_vote, :id => reply, :user_id => session[:id] %>
             <% end %>
           <b># of votes:</b> <%= reply.num_of_votes %>
          </div>
      <% end %>

    <br>
    <b># of votes:</b> <%= post.num_of_votes %>
     <% if session[:id] %>
      <%= form_tag(:action => :add_reply, :post_id => post, :user_id => session[:id]) do %>
        <%= text_area_tag(:text) %>
      <%= submit_tag("Add Reply") %>
     <% end %>
     <br>
<% end %>
    <% if session[:id] %>
    <%= button_to "Vote Post" , :action => :add_vote, :id => post, :user_id => session[:id] %>
    <% end %>
   </div>
  </tr>
<% end %>
</table>

<br />
<% if session[:id] %>
    <p><%= session[:username] %> : <%= link_to "Log Out", logout_path %></p>
    <%= link_to 'New Post', new_post_path %>
<% end %>